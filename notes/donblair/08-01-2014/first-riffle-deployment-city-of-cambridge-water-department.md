---
title: "First Riffle Deployment: City of Cambridge Water Department"\ntagnames: 'somerville-massachusetts, cambridge, massachusetts, water-quality, riffle, northeast, riffle-examples'
author: donblair
path: /notes/donblair/08-01-2014/first-riffle-deployment-city-of-cambridge-water-department.md
nid: 11004
uid: 43651

---

![](https://publiclab.org/public/system/images/photos/000/005/740/original/IMG_0357.JPG)

# First Riffle Deployment: City of Cambridge Water Department

by [donblair](../profile/donblair) | August 01, 2014 20:53

August 01, 2014 20:53 | Tags: [somerville-massachusetts](../tag/somerville-massachusetts), [cambridge](../tag/cambridge), [massachusetts](../tag/massachusetts), [water-quality](../tag/water-quality), [riffle](../tag/riffle), [northeast](../tag/northeast), [riffle-examples](../tag/riffle-examples)

----

> NOTE:  We presented a [poster](https://github.com/p-v-o-s/riffle-ito/raw/master/artwork/epa-demo-aug-2014/epa_poster_august_2014-contrib.pdf) summarizing the data from this deployment at the EPA's 'Advanced Tech Demo' on Aug 5th.

## photos

[![IMG_0484.JPG](https://i.publiclab.org/system/images/photos/000/005/777/medium/IMG_0484.JPG)](https://i.publiclab.org/system/images/photos/000/005/777/original/IMG_0484.JPG)

[![IMG_0483.JPG](https://i.publiclab.org/system/images/photos/000/005/776/medium/IMG_0483.JPG)](https://i.publiclab.org/system/images/photos/000/005/776/original/IMG_0483.JPG)

[![IMG_0465.JPG](https://i.publiclab.org/system/images/photos/000/005/775/medium/IMG_0465.JPG)](https://i.publiclab.org/system/images/photos/000/005/775/original/IMG_0465.JPG)

[![IMG_0473.JPG](https://i.publiclab.org/system/images/photos/000/005/774/medium/IMG_0473.JPG)](https://i.publiclab.org/system/images/photos/000/005/774/original/IMG_0473.JPG)

[![IMG_0461.JPG](https://i.publiclab.org/system/images/photos/000/005/773/medium/IMG_0461.JPG)](https://i.publiclab.org/system/images/photos/000/005/773/original/IMG_0461.JPG)

[![IMG_0460.JPG](https://i.publiclab.org/system/images/photos/000/005/772/medium/IMG_0460.JPG)](https://i.publiclab.org/system/images/photos/000/005/772/original/IMG_0460.JPG)

[![IMG_0457.JPG](https://i.publiclab.org/system/images/photos/000/005/771/medium/IMG_0457.JPG)](https://i.publiclab.org/system/images/photos/000/005/771/original/IMG_0457.JPG)

[![IMG_0458.JPG](https://i.publiclab.org/system/images/photos/000/005/770/medium/IMG_0458.JPG)](https://i.publiclab.org/system/images/photos/000/005/770/original/IMG_0458.JPG)

[![IMG_0438.JPG](https://i.publiclab.org/system/images/photos/000/005/769/medium/IMG_0438.JPG)](https://i.publiclab.org/system/images/photos/000/005/769/original/IMG_0438.JPG)

[![IMG_0423.JPG](https://i.publiclab.org/system/images/photos/000/005/768/medium/IMG_0423.JPG)](https://i.publiclab.org/system/images/photos/000/005/768/original/IMG_0423.JPG)

[![IMG_0422.JPG](https://i.publiclab.org/system/images/photos/000/005/767/medium/IMG_0422.JPG)](https://i.publiclab.org/system/images/photos/000/005/767/original/IMG_0422.JPG)

[![IMG_0418.JPG](https://i.publiclab.org/system/images/photos/000/005/766/medium/IMG_0418.JPG)](https://i.publiclab.org/system/images/photos/000/005/766/original/IMG_0418.JPG)

[![IMG_0420.JPG](https://i.publiclab.org/system/images/photos/000/005/765/medium/IMG_0420.JPG)](https://i.publiclab.org/system/images/photos/000/005/765/original/IMG_0420.JPG)

[![IMG_0412.JPG](https://i.publiclab.org/system/images/photos/000/005/764/medium/IMG_0412.JPG)](https://i.publiclab.org/system/images/photos/000/005/764/original/IMG_0412.JPG)

[![IMG_0405.JPG](https://i.publiclab.org/system/images/photos/000/005/763/medium/IMG_0405.JPG)](https://i.publiclab.org/system/images/photos/000/005/763/original/IMG_0405.JPG)

[![IMG_0404.JPG](https://i.publiclab.org/system/images/photos/000/005/762/medium/IMG_0404.JPG)](https://i.publiclab.org/system/images/photos/000/005/762/original/IMG_0404.JPG)

[![IMG_0403.JPG](https://i.publiclab.org/system/images/photos/000/005/761/medium/IMG_0403.JPG)](https://i.publiclab.org/system/images/photos/000/005/761/original/IMG_0403.JPG)

[![IMG_0402.JPG](https://i.publiclab.org/system/images/photos/000/005/760/medium/IMG_0402.JPG)](https://i.publiclab.org/system/images/photos/000/005/760/original/IMG_0402.JPG)

[![IMG_0399.JPG](https://i.publiclab.org/system/images/photos/000/005/759/medium/IMG_0399.JPG)](https://i.publiclab.org/system/images/photos/000/005/759/original/IMG_0399.JPG)

[![IMG_0398.JPG](https://i.publiclab.org/system/images/photos/000/005/758/medium/IMG_0398.JPG)](https://i.publiclab.org/system/images/photos/000/005/758/original/IMG_0398.JPG)

[![IMG_0394.JPG](https://i.publiclab.org/system/images/photos/000/005/757/medium/IMG_0394.JPG)](https://i.publiclab.org/system/images/photos/000/005/757/original/IMG_0394.JPG)

[![IMG_0396.JPG](https://i.publiclab.org/system/images/photos/000/005/756/medium/IMG_0396.JPG)](https://i.publiclab.org/system/images/photos/000/005/756/original/IMG_0396.JPG)

[![IMG_0380.JPG](https://i.publiclab.org/system/images/photos/000/005/754/medium/IMG_0380.JPG)](https://i.publiclab.org/system/images/photos/000/005/754/original/IMG_0380.JPG)

[![IMG_0388.JPG](https://i.publiclab.org/system/images/photos/000/005/755/medium/IMG_0388.JPG)](https://i.publiclab.org/system/images/photos/000/005/755/original/IMG_0388.JPG)

[![IMG_0386.JPG](https://i.publiclab.org/system/images/photos/000/005/753/medium/IMG_0386.JPG)](https://i.publiclab.org/system/images/photos/000/005/753/original/IMG_0386.JPG)

[![IMG_0376.JPG](https://i.publiclab.org/system/images/photos/000/005/752/medium/IMG_0376.JPG)](https://i.publiclab.org/system/images/photos/000/005/752/original/IMG_0376.JPG)

[![IMG_0375.JPG](https://i.publiclab.org/system/images/photos/000/005/751/medium/IMG_0375.JPG)](https://i.publiclab.org/system/images/photos/000/005/751/original/IMG_0375.JPG)

[![IMG_0366.JPG](https://i.publiclab.org/system/images/photos/000/005/749/medium/IMG_0366.JPG)](https://i.publiclab.org/system/images/photos/000/005/749/original/IMG_0366.JPG)

[![IMG_0373.JPG](https://i.publiclab.org/system/images/photos/000/005/748/medium/IMG_0373.JPG)](https://i.publiclab.org/system/images/photos/000/005/748/original/IMG_0373.JPG)

[![IMG_0369.JPG](https://i.publiclab.org/system/images/photos/000/005/747/medium/IMG_0369.JPG)](https://i.publiclab.org/system/images/photos/000/005/747/original/IMG_0369.JPG)

[![IMG_0357.JPG](https://i.publiclab.org/system/images/photos/000/005/746/medium/IMG_0357.JPG)](https://i.publiclab.org/system/images/photos/000/005/746/original/IMG_0357.JPG)

[![IMG_0356.JPG](https://i.publiclab.org/system/images/photos/000/005/745/medium/IMG_0356.JPG)](https://i.publiclab.org/system/images/photos/000/005/745/original/IMG_0356.JPG)

[![IMG_0343.JPG](https://i.publiclab.org/system/images/photos/000/005/741/medium/IMG_0343.JPG)](https://i.publiclab.org/system/images/photos/000/005/741/original/IMG_0343.JPG)

[![IMG_0346.JPG](https://i.publiclab.org/system/images/photos/000/005/742/medium/IMG_0346.JPG)](https://i.publiclab.org/system/images/photos/000/005/742/original/IMG_0346.JPG)

[![IMG_0349.JPG](https://i.publiclab.org/system/images/photos/000/005/744/medium/IMG_0349.JPG)](https://i.publiclab.org/system/images/photos/000/005/744/original/IMG_0349.JPG)

[![IMG_0344.JPG](https://i.publiclab.org/system/images/photos/000/005/743/medium/IMG_0344.JPG)](https://i.publiclab.org/system/images/photos/000/005/743/original/IMG_0344.JPG)


### riffle code
https://gist.github.com/dwblair/26313551dbac1db6ef11

### theory and simulation

Jeff Walker set up an online web app that allowed for an exploration of what frequency (Hz) from the 555 timer-based conductivity sensor to expect, for a given value of the conductivity (uS/cm):

http://walkerjeffd.shinyapps.io/riffle-conductivity/

### analysis

... and then wrote up a detailed analysis of the data that came off the two Riffles we deployed, and how they compared to the USGS sensor located at the same spot:

https://github.com/walkerjeffd/riffle-ito-apps/blob/master/analyses/20140725_cambridge/index.md

I'm just going to pull out some salient points from this analysis, here ...

- The second Riffle we'd deployed measured the conductivity using a '555 timer circuit'.  The principle behind this is explained in two earlier research notes on the topic, [here](http://publiclab.org/notes/donblair/05-28-2014/riffle-dev-fun-w-five-five-fives) and [here](http://publiclab.org/notes/donblair/05-28-2014/riffle-dev-closer-to-conductivity-measuring-555-oscillations-with-an-arduino).  The basic idea is this:  the 555 timer outputs an oscillating square wave signal whose frequency is dependent on a resistor placed across two of its pins.  Instead of using a resistor, we're connecting each of these two pins to an electrode (in our case, a stainless steel screw) and placing both of these electrodes in water.  The water then acts as a 'resistor', and determines the frequency of the 555 output.  By measuring this frequency, we can than assess the resistivity of the water -- and thus its inverse, the conductivity.  
- In order to get 'real units' from this measurement, though, we need to figure out some more details.  The particular in-water electrode materials and geometry that we use will affect the 'resistance' that the 555 circuit sees, so we need some way of calibrating our particular setup.  
- The electrode geometry is referred to as the 'cell constant', and is often very hard to calculate theoretically -- it's best just to determine it by using the electrodes to measure solutions with known conductivity, and backing out the value by fitting the resultant curve.
- The idea here is that there is an equation that relates the frequency of the 555 output to the conductivity of the solution and the 'cell constant' -- so if we measure the frequency of a bunch of solutions with known conductivity, we can do a least-squares fit of this equation to the resultant data, by floating the cell constant parameter (we call this cell constant 'L/A' in our analysis).  
- Note: the conductivity also depends on the temperature, so we have to account for this as well.  
- Here is the derivation of the frequency vs. (conductivity, L/a) equation, as well as the assumed relationship between conductivity and temperature (from Jeff's writeup):


[![frequencyBackground.png](https://i.publiclab.org/system/images/photos/000/006/119/medium/frequencyBackground.png)](https://i.publiclab.org/system/images/photos/000/006/119/original/frequencyBackground.png)

We generated a set of conductivity 'calibration solutions' following the procedure outline in [this research note](http://publiclab.org/notes/donblair/07-22-2014/accessible-procedure-for-calibrating-conductivity-measurements), and collected the data in [this google spreadsheet](https://docs.google.com/spreadsheets/d/1VYbCg0TOsdpzL2XVZbKudoSGCnire0_Q3z77r4luqtA/edit#gid=0).  Here's a google docs plot of that data:


[![hzVs.png](https://i.publiclab.org/system/images/photos/000/006/120/medium/hzVs.png)](https://i.publiclab.org/system/images/photos/000/006/120/original/hzVs.png)

I believe that the apparent inflection point in the middle of the conductivity range is due to a change in protocol midway through the calibration procedure.  The entire process was quite sloppy -- will aim to be a bit more careful next time.  But good enough for a first pass ...

Then, Jeff used a fitting procedure to find a value for L/A that allowed us to fit the equation for frequency vs. conductivity nicely to that calibration curve:


[![conductivityCalibration.png](https://i.publiclab.org/system/images/photos/000/006/117/medium/conductivityCalibration.png)](https://i.publiclab.org/system/images/photos/000/006/117/original/conductivityCalibration.png)


Now we have a 'calibrated conductivity sensor', and we were then ready to deploy this sensor in the field.

The first data we looked at after we got the Riffles back was the photocell data.  As we'd hoped, the photocell registered the daily changes in light level:

[![plot_light.png](https://i.publiclab.org/system/images/photos/000/005/999/medium/plot_light.png)](https://i.publiclab.org/system/images/photos/000/005/999/original/plot_light.png)

Jeff then plotted every day's light level changes on the same 24 hour x-axis, so see how they compared:

[![plot_light_hour.png](https://i.publiclab.org/system/images/photos/000/006/002/medium/plot_light_hour.png)](https://i.publiclab.org/system/images/photos/000/006/002/original/plot_light_hour.png)

Fun!  The next thing to check was the temperature data.  When we had gone out to the field to deploy the second Riffle, it was clear even before we put it in the water that the temperature sensors weren't working properly -- both the RTC temp and thermistor temp were very far away from ambient air temperature when we tested them on the shore.  This is clear when looking at the comparison of thermistor and RTC values in both the first and second riffle data:

[![plot_temp_ts.png](https://i.publiclab.org/system/images/photos/000/006/001/medium/plot_temp_ts.png)](https://i.publiclab.org/system/images/photos/000/006/001/original/plot_temp_ts.png)

Probably this was a short in the crazy circuit we'd put together as a conductivity prototype; but since we didn't want to waste a deployment opportunity, we put this riffle out there anyway, thinking that maybe only the temperature values were off, and otherwise the conductivity sensor would work alright (and we could use the other riffle's temperature values to temperature-correct the conductivity readings).  When looking at the data that resulted, it's clear that the first riffle's temp is much more closely aligned with the USGS sensor -- but the second riffle's temp (noisy, and probably because of a short circuit) still shows the right trend:

[![plot_usgs_riffle_temp.png](https://i.publiclab.org/system/images/photos/000/006/003/medium/plot_usgs_riffle_temp.png)](https://i.publiclab.org/system/images/photos/000/006/003/original/plot_usgs_riffle_temp.png)

Finally, we used our fitted conductivity 'L/A' parameter to interpret the frequency data we'd gotten from our 555 conductivity circuit to find the conductivity trace, and compared that to the USGS sensor:

[![conductivity.png](https://i.publiclab.org/system/images/photos/000/006/000/medium/conductivity.png)](https://i.publiclab.org/system/images/photos/000/006/000/original/conductivity.png)

Not bad!  We're not sure whether the differences in these curves are due to changes in the conductivity of the solution, or because e.g. our electrodes were corroding faster than we thought ... further tests will need to be done  -- hopefully with a lot of input from the community!

All in all, though, it was a great first trial run!  

### next steps

- We're going to try to make a more detailed calibration procedure (for both temp and conductivity), and begin to send out riffles to folks who'd like to help us figure out a good, accessible protocol ...

- We're going to see if we can make a simple turbidity measurement (more on the idea that Jiansheng came up with to address this, soon!)